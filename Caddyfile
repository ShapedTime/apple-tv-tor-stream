# Caddy configuration for momoshtrem WebDAV
# Provides: HTTPS via self-signed certificate, HTTP Basic Auth, Reverse Proxy

{
    # Use internal CA for all certificates
    local_certs
}

# Listen on port 36911 for external access
momoshtrem.duckdns.org:36911 {
    # Self-signed certificate from Caddy's internal CA
    tls internal

    # HTTP Basic Authentication
    # Generate password hash with:
    #   docker run --rm caddy:2-alpine caddy hash-password --plaintext "YourStrongPassword"
    basicauth * {
        momosh $2a$14$ZHPCCCNMzJVMvYD4aofDJu3fIMnhzH.K6EUmtmoZXgPGe7lJNBfSy
    }

    # Reverse proxy to momoshtrem WebDAV
    reverse_proxy momoshtrem:36911

    log {
        output stdout
    }
}


momoshtrem.duckdns.org:3000 {
    # Self-signed certificate from Caddy's internal CA
    tls internal

    # Reverse proxy to momoshtrem WebDAV
    reverse_proxy prettytvcatalog:3000

    log {
        output stdout
    }
}

http://tv.home:9090 {
    reverse_proxy momoshtrem:9090
    @denied not remote_ip 192.168.0.0/24
    abort @denied
}


http://192.168.0.81:9090 {
    reverse_proxy momoshtrem:9090
    @denied not remote_ip 192.168.0.0/24
    abort @denied
}

http://tv.home:5050 {
    reverse_proxy pgadmin:80
    @denied not remote_ip 192.168.0.0/24
    abort @denied
}

http://192.168.0.81:5050 {
    reverse_proxy pgadmin:80
    @denied not remote_ip 192.168.0.0/24
    abort @denied
}