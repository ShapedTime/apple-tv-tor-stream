version: '3'

services:
  # mediatracker:
  #   container_name: MediaTracker
  #   ports:
  #     - 7481:7481
  #   volumes:
  #     # - ${HOME}/.config/mediatracker:/storage
  #     - assetsVolume:/assets
  #   build:
  #     context: ./MediaTracker
  #     dockerfile: Dockerfile
  #   environment:
  #     - TORRENT_STREAM_URL=http://stremio-torrent-stream:58827
  #     - DISTRIBYTED_URL=http://distribyted:4444
  #     - DISTRIBYTED_ROUTE=default
  #   depends_on:
  #     - stremio-torrent-stream
  #     - distribyted

  stremio-torrent-stream:
    build:
      context: ./stremio-torrent-stream
      dockerfile: Dockerfile
    container_name: stremio-torrent-stream
    ports:
      - 58827:58827
      - 58828:58828
    # environment:
      # - JACKETT_URL=http://jackett:9117
      # Set JACKETT_KEY via .env file or directly here
      # - JACKETT_KEY=your_api_key
    restart: unless-stopped
  #   depends_on:
  #     - jackett

  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: jackett
    ports:
      - 9117:9117
    volumes:
      - ${HOME}/.config/jackett:/config
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    restart: unless-stopped

  distribyted:
    container_name: distribyted
    build:
      context: ./distribyted
      dockerfile: Dockerfile
    ports:
      - 4444:4444
      - 36911:36911
    # volumes:
      # - ${HOME}/.config/distribyted/mount:/distribyted-data/mount:shared
      # - ${HOME}/.config/distribyted/metadata:/distribyted-data/metadata
      # - ${HOME}/.config/distribyted/config:/distribyted-data/config
    security_opt:
      - apparmor:unconfined
    # devices:
    #   - /dev/fuse
    cap_add:
      - SYS_ADMIN
    restart: unless-stopped

  prettytvcatalog:
    container_name: PrettyTVCatalog
    build:
      context: ./PrettyTVCatalog
      dockerfile: Dockerfile
    ports:
      - 3000:3000
    volumes:
      - ./PrettyTVCatalog/data:/app/data
    environment:
      - TMDB_API_KEY=64ac8534e22680f183eeb0797d42e71b
      - STREMIO_API_URL=http://stremio-torrent-stream:58827
      - DISTRIBYTED_API_URL=http://distribyted:4444
      - DISTRIBYTED_DEFAULT_ROUTE=default
    depends_on:
      - stremio-torrent-stream
      - distribyted
    restart: unless-stopped

volumes:
  assetsVolume: null
